language: cpp

sudo: true

dist: xenial

compiler:
        - gcc
        - clang

stages:
        - smoke-test
        - main-test
        - extended-test

matrix:
        include:
                ## Xenial/GCC
                # Smoke tests
                - env:
                        - TARGET=smoke
                        - TABLE=1
                  stage: smoke-test
                - env:
                        - TARGET=smoke
                        - TABLE=2
                  stage: smoke-test
                - env:
                        - TARGET=smoke
                        - TABLE=3
                  stage: smoke-test
                - env:
                        - TARGET=smoke
                        - TABLE=4
                  stage: smoke-test
                # Main tests
                - env:
                        - TARGET=main
                        - TABLE=1
                  stage: main-test
                - env:
                        - TARGET=main
                        - TABLE=2
                  stage: main-test
                - env:
                        - TARGET=main
                        - TABLE=3
                  stage: main-test
                - env:
                        - TARGET=main
                        - TABLE=4
                  stage: main-test
                # Extended tests
                - env:
                        - TARGET=extended
                        - TABLE=1
                  stage: extended-test
                - env:
                        - TARGET=extended
                        - TABLE=2
                  stage: extended-test
                - env:
                        - TARGET=extended
                        - TABLE=3
                  stage: extended-test
                - env:
                        - TARGET=extended
                        - TABLE=4
                  stage: extended-test

before_install:
        - sudo apt-get -y update
        - sudo apt-get -y install build-essential

install:
        - make

script:
        - travis_wait 180 ./travis/travis_${TARGET}_test.sh ${TABLE}
